Le code est pas tres propre, il y a quelques confusions/répétitions/variables avec des noms un peu limite.

A fixer ça !!